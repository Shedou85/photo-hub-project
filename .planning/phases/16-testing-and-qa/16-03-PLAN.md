---
phase: 16-testing-and-qa
plan: 03
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - frontend/package.json
  - frontend/playwright.config.js
  - frontend/e2e/visual-regression/multi-locale.spec.js
  - frontend/e2e/cross-browser/responsive-layout.spec.js
  - frontend/e2e/accessibility/wcag-compliance.spec.js
autonomous: true

must_haves:
  truths:
    - "Playwright is installed and configured for Chromium, Firefox, and WebKit"
    - "Visual regression tests capture screenshots for all 3 locales (EN/LT/RU) on key pages"
    - "Cross-browser responsive layout test verifies mobile and desktop breakpoints"
    - "Accessibility test runs axe-core WCAG 2.1 AA scan on public pages"
  artifacts:
    - path: "frontend/playwright.config.js"
      provides: "Playwright configuration with 3 browser projects"
      contains: "chromium"
    - path: "frontend/e2e/visual-regression/multi-locale.spec.js"
      provides: "Multi-locale screenshot comparison tests"
      contains: "i18nextLng"
    - path: "frontend/e2e/cross-browser/responsive-layout.spec.js"
      provides: "Responsive layout verification at mobile/tablet/desktop sizes"
      contains: "viewport"
    - path: "frontend/e2e/accessibility/wcag-compliance.spec.js"
      provides: "Automated accessibility scanning with axe-core"
      contains: "AxeBuilder"
  key_links:
    - from: "frontend/playwright.config.js"
      to: "https://pixelforge.pro"
      via: "baseURL for all E2E tests"
      pattern: "pixelforge.pro"
    - from: "frontend/e2e/visual-regression/multi-locale.spec.js"
      to: "frontend/src/locales/"
      via: "localStorage i18nextLng controls which locale renders"
      pattern: "i18nextLng"
    - from: "frontend/e2e/accessibility/wcag-compliance.spec.js"
      to: "@axe-core/playwright"
      via: "axe-core accessibility engine"
      pattern: "AxeBuilder"
---

<objective>
Set up Playwright E2E testing with cross-browser support, multi-locale visual regression tests, and automated accessibility scanning.

Purpose: Cover TEST-01 (cross-browser), TEST-04 (multi-locale visual regression with overflow checks), and automated accessibility validation. These E2E tests run against production to verify real-world behavior.
Output: Playwright config, 3 E2E test files covering visual regression, responsive layouts, and accessibility.
</objective>

<execution_context>
@C:/Users/Marius/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Marius/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-testing-and-qa/16-RESEARCH.md
@.planning/phases/16-testing-and-qa/16-01-SUMMARY.md

@frontend/package.json
@frontend/src/locales/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and axe-core, create Playwright config</name>
  <files>
    frontend/package.json
    frontend/playwright.config.js
  </files>
  <action>
Install Playwright and accessibility testing:
```bash
cd frontend && npm install -D @playwright/test @axe-core/playwright
cd frontend && npx playwright install chromium firefox webkit
```

Create `frontend/playwright.config.js`:
```javascript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'https://pixelforge.pro',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    {
      name: 'chromium-desktop',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox-desktop',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit-desktop',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'mobile-chrome',
      use: { ...devices['Pixel 5'] },
    },
    {
      name: 'mobile-safari',
      use: { ...devices['iPhone 13'] },
    },
  ],
  snapshotDir: './e2e/__screenshots__',
  expect: {
    toHaveScreenshot: {
      maxDiffPixels: 100,
    },
  },
});
```

Add npm scripts to package.json:
- `"test:e2e": "playwright test"`
- `"test:e2e:ui": "playwright test --ui"`
- `"test:e2e:update-snapshots": "playwright test --update-snapshots"`
  </action>
  <verify>
Run `cd frontend && npx playwright --version` — prints Playwright version without errors.
Verify config loads: `cd frontend && npx playwright test --list` — lists 0 tests (no test files yet), no config errors.
  </verify>
  <done>Playwright installed with Chromium, Firefox, WebKit browsers. Config defines 5 projects (3 desktop + 2 mobile). npm scripts available for running E2E tests.</done>
</task>

<task type="auto">
  <name>Task 2: Create multi-locale visual regression and cross-browser responsive tests</name>
  <files>
    frontend/e2e/visual-regression/multi-locale.spec.js
    frontend/e2e/cross-browser/responsive-layout.spec.js
    frontend/e2e/accessibility/wcag-compliance.spec.js
  </files>
  <action>
Create `frontend/e2e/visual-regression/multi-locale.spec.js`:
- Test homepage (/) in all 3 locales (en, lt, ru)
- Test login page (/login) in all 3 locales
- For each locale:
  1. Use `page.addInitScript()` to set `localStorage.setItem('i18nextLng', locale)` before navigation
  2. Navigate to page
  3. Wait for `page.waitForLoadState('networkidle')` to ensure fonts and i18n loaded
  4. Take full-page screenshot with `expect(page).toHaveScreenshot('pagename-locale.png', { fullPage: true })`
- This covers TEST-04: multi-locale visual regression
- The 30% width buffer check is visual — screenshots will show overflow if translations break layout

Create `frontend/e2e/cross-browser/responsive-layout.spec.js`:
- Test homepage at 3 viewport sizes: mobile (375x667), tablet (768x1024), desktop (1920x1080)
- Test login page at same 3 sizes
- For each size:
  1. Set viewport via `page.setViewportSize({ width, height })`
  2. Navigate to page
  3. Wait for networkidle
  4. Take screenshot: `expect(page).toHaveScreenshot('pagename-WIDTHxHEIGHT.png')`
- Also test at 2560x1440 to cover TEST-05 desktop monitor sizes
- This covers TEST-01 cross-browser (runs across all 5 Playwright projects) and TEST-05 desktop monitor sizes

Create `frontend/e2e/accessibility/wcag-compliance.spec.js`:
- Import `AxeBuilder` from `@axe-core/playwright`
- Test homepage (/) for WCAG 2.1 AA compliance
- Test login page (/login) for WCAG 2.1 AA compliance
- For each page:
  1. Navigate to page
  2. Run `new AxeBuilder({ page }).withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa']).analyze()`
  3. Assert `violations` is empty array
  4. If violations exist, format them as readable error messages showing: rule ID, impact, affected elements
- Use only `chromium-desktop` project for accessibility tests (axe results are browser-independent)

Note: These E2E tests run against production (pixelforge.pro). They test public pages only (no auth required). The first run will create baseline screenshots. Subsequent runs compare against baselines.
  </action>
  <verify>
List tests: `cd frontend && npx playwright test --list` — should show all test cases across all projects.
Note: Full E2E run requires network access to pixelforge.pro. Verify test files are syntactically correct: `cd frontend && node -e "import('./e2e/visual-regression/multi-locale.spec.js')" 2>&1 || echo "ESM import check - Playwright handles this internally"`
  </verify>
  <done>3 E2E test files created covering: multi-locale visual regression (6 screenshot comparisons), cross-browser responsive layouts (multiple viewport tests), and WCAG accessibility scanning. Tests are ready to run against production.</done>
</task>

</tasks>

<verification>
1. `cd frontend && npx playwright --version` — prints version
2. `cd frontend && npx playwright test --list` — lists all tests without config errors
3. All 3 E2E test files exist with proper Playwright test structure
4. `playwright.config.js` has 5 projects (3 desktop browsers + 2 mobile devices)
5. Visual regression tests cover all 3 locales (en, lt, ru)
6. Responsive tests cover 4 viewport sizes including 2560x1440
7. Accessibility test uses axe-core with WCAG 2.1 AA tags
8. Zero ESLint warnings: `cd frontend && npm run lint`
</verification>

<success_criteria>
- Playwright config defines projects for Chrome, Firefox, Safari (desktop) + Chrome, Safari (mobile)
- Multi-locale test takes screenshots of homepage and login in EN/LT/RU (6 screenshots)
- Responsive test covers mobile (375px), tablet (768px), desktop (1920px), ultrawide (2560px)
- Accessibility test runs axe-core WCAG 2.1 AA on homepage and login
- All tests can be listed via `npx playwright test --list` without errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-testing-and-qa/16-03-SUMMARY.md`
</output>
