---
phase: 16-testing-and-qa
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/vitest.config.js
  - frontend/src/__tests__/setup.js
  - frontend/src/__tests__/mocks/i18n.js
  - frontend/src/__tests__/utils/test-utils.jsx
  - frontend/src/components/primitives/Button.test.jsx
  - frontend/src/components/primitives/Card.test.jsx
  - frontend/src/components/primitives/Badge.test.jsx
  - frontend/src/components/primitives/CollectionCard.test.jsx
  - frontend/src/components/ProtectedRoute.test.jsx
  - frontend/src/contexts/AuthContext.test.jsx
autonomous: true

must_haves:
  truths:
    - "Vitest runs and passes with `npm test` command"
    - "Primitive components have unit tests covering variants, props, and user interaction"
    - "AuthContext and ProtectedRoute have tests verifying auth state behavior"
    - "Tests use custom render utility with i18n, Router, and AuthContext providers"
  artifacts:
    - path: "frontend/vitest.config.js"
      provides: "Vitest configuration extending Vite config"
      contains: "environment: 'jsdom'"
    - path: "frontend/src/__tests__/setup.js"
      provides: "Global test setup with jest-dom matchers"
      contains: "@testing-library/jest-dom"
    - path: "frontend/src/__tests__/utils/test-utils.jsx"
      provides: "Custom render with all providers (i18n, Router, AuthContext)"
      contains: "I18nextProvider"
    - path: "frontend/src/__tests__/mocks/i18n.js"
      provides: "Mock i18n instance for tests with synchronous init"
      contains: "initReactI18next"
    - path: "frontend/src/components/primitives/Button.test.jsx"
      provides: "Button component tests"
      contains: "describe('Button'"
    - path: "frontend/src/components/primitives/Card.test.jsx"
      provides: "Card component tests"
      contains: "describe('Card'"
    - path: "frontend/src/components/primitives/Badge.test.jsx"
      provides: "Badge component tests"
      contains: "describe('Badge'"
    - path: "frontend/src/components/primitives/CollectionCard.test.jsx"
      provides: "CollectionCard component tests"
      contains: "describe('CollectionCard'"
  key_links:
    - from: "frontend/vitest.config.js"
      to: "frontend/vite.config.js"
      via: "mergeConfig extending vite config"
      pattern: "mergeConfig.*viteConfig"
    - from: "frontend/src/__tests__/utils/test-utils.jsx"
      to: "frontend/src/contexts/AuthContext.jsx"
      via: "wrapping rendered components with AuthProvider"
      pattern: "AuthProvider"
    - from: "frontend/src/__tests__/utils/test-utils.jsx"
      to: "frontend/src/__tests__/mocks/i18n.js"
      via: "I18nextProvider with mock i18n instance"
      pattern: "I18nextProvider.*i18n"
---

<objective>
Set up Vitest + React Testing Library infrastructure and write unit tests for all primitive components, AuthContext, and ProtectedRoute.

Purpose: Establish the testing foundation that all other test plans build upon. Primitive components are the most testable units with clear prop-to-render contracts.
Output: Working test suite with `npm test` command, custom render utility, 6 test files covering all primitives + auth.
</objective>

<execution_context>
@C:/Users/Marius/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Marius/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-testing-and-qa/16-RESEARCH.md

@frontend/vite.config.js
@frontend/package.json
@frontend/src/components/primitives/Button.jsx
@frontend/src/components/primitives/Card.jsx
@frontend/src/components/primitives/Badge.jsx
@frontend/src/components/primitives/CollectionCard.jsx
@frontend/src/components/ProtectedRoute.jsx
@frontend/src/contexts/AuthContext.jsx
@frontend/src/i18n.js
@frontend/src/locales/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vitest + RTL dependencies and configure test infrastructure</name>
  <files>
    frontend/package.json
    frontend/vitest.config.js
    frontend/src/__tests__/setup.js
    frontend/src/__tests__/mocks/i18n.js
    frontend/src/__tests__/utils/test-utils.jsx
  </files>
  <action>
Install testing dependencies in frontend/:
```bash
cd frontend && npm install -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom @vitest/ui
```

Create `frontend/vitest.config.js`:
- Use `mergeConfig` to extend `vite.config.js`
- Set `test.globals: true`, `test.environment: 'jsdom'`
- Set `test.setupFiles: './src/__tests__/setup.js'`
- Set `test.css: true` (so Tailwind class assertions work)

Create `frontend/src/__tests__/setup.js`:
- Import `@testing-library/jest-dom` for matchers like `toBeInTheDocument()`

Create `frontend/src/__tests__/mocks/i18n.js`:
- Create a synchronous i18n instance using `i18next.use(initReactI18next).init({...})`
- Set `lng: 'en'`, `fallbackLng: 'en'`
- Load real English translations from `../../locales/en.json`, Lithuanian from `../../locales/lt.json`, Russian from `../../locales/ru.json`
- Set `interpolation.escapeValue: false`
- Export the configured instance

Create `frontend/src/__tests__/utils/test-utils.jsx`:
- Import `render` from `@testing-library/react`
- Import `I18nextProvider` from `react-i18next`
- Import `BrowserRouter` from `react-router-dom`
- Import mock i18n instance from `../mocks/i18n`
- Create `customRender(ui, options = {})` that wraps ui with I18nextProvider + BrowserRouter
- Accept optional `locale` in options, call `i18n.changeLanguage(locale)` if provided
- Do NOT wrap with AuthProvider in the default render (components under ProtectedRoute don't need it in tests, and AuthContext tests will need to test the provider itself)
- Re-export everything from `@testing-library/react` plus override `render` with customRender

Add npm scripts to `frontend/package.json`:
- `"test": "vitest"`
- `"test:ui": "vitest --ui"`
- `"test:run": "vitest run"` (single run, for CI)
  </action>
  <verify>
Run `cd frontend && npx vitest run --passWithNoTests` to verify Vitest starts and exits cleanly with 0 errors.
  </verify>
  <done>Vitest configured and running, custom render utility works with i18n and Router providers, npm test scripts available.</done>
</task>

<task type="auto">
  <name>Task 2: Write unit tests for Button, Card, Badge primitives</name>
  <files>
    frontend/src/components/primitives/Button.test.jsx
    frontend/src/components/primitives/Card.test.jsx
    frontend/src/components/primitives/Badge.test.jsx
  </files>
  <action>
Read each primitive component source first to understand their exact props and behavior.

Create `frontend/src/components/primitives/Button.test.jsx`:
- Test default rendering: renders children text, has role="button"
- Test variant prop: primary, secondary, danger, ghost each apply distinct class sets
- Test size prop: if the component accepts sizes (sm, md, lg)
- Test fullWidth prop: applies w-full class when true
- Test onClick handler: user click calls the handler
- Test disabled state: button is disabled, click does not fire handler
- Test type defaults to 'button' (not 'submit' — per project decision)
- Test loading state if applicable (renders loading indicator)
- Test className passthrough: additional classes merge with defaults via clsx

Create `frontend/src/components/primitives/Card.test.jsx`:
- Test renders children content
- Test applies default card styling (border, rounded, padding)
- Test className passthrough merges correctly
- Test renders as a div by default

Create `frontend/src/components/primitives/Badge.test.jsx`:
- Test renders label text
- Test status variants: DRAFT (gray), SELECTING (blue), REVIEWING (green), DELIVERED (purple) each apply correct colors
- Test renders colored dot indicator for non-DRAFT statuses
- Test className passthrough

Use the custom render from `__tests__/utils/test-utils.jsx` for all tests. Use `@testing-library/user-event` for click interactions. Use `screen.getByRole`, `screen.getByText` semantic queries — avoid `getByTestId`.
  </action>
  <verify>
Run `cd frontend && npx vitest run src/components/primitives/Button.test.jsx src/components/primitives/Card.test.jsx src/components/primitives/Badge.test.jsx` — all tests pass.
  </verify>
  <done>Button, Card, Badge each have passing unit tests covering variants, props, and user interaction.</done>
</task>

<task type="auto">
  <name>Task 3: Write unit tests for CollectionCard, ProtectedRoute, AuthContext</name>
  <files>
    frontend/src/components/primitives/CollectionCard.test.jsx
    frontend/src/components/ProtectedRoute.test.jsx
    frontend/src/contexts/AuthContext.test.jsx
  </files>
  <action>
Read each component source first.

Create `frontend/src/components/primitives/CollectionCard.test.jsx`:
- Test renders collection title
- Test renders photo count
- Test renders status badge with correct status text
- Test renders formatted date
- Test cover image: when coverUrl provided, renders img; when not, renders placeholder
- Test click behavior: clicking card triggers onClick or navigates (depending on implementation)
- Test uses React.memo (verify by checking component type or displayName if set)
- Use custom render with i18n provider for translated strings

Create `frontend/src/components/ProtectedRoute.test.jsx`:
- Must test WITH AuthContext, so create a test-specific wrapper
- Test when authenticated: renders children
- Test when NOT authenticated: redirects to /login (check via react-router MemoryRouter with initial route, verify Navigate renders)
- Mock AuthContext by wrapping with a custom AuthProvider that exposes controlled state, or use jest.mock/vi.mock on the context module to return controlled values

Create `frontend/src/contexts/AuthContext.test.jsx`:
- Test initial state: loads user from localStorage if present, isAuthenticated is true
- Test initial state: no localStorage data, isAuthenticated is false
- Test login: sets user in state and localStorage
- Test logout: clears user from state and localStorage, isAuthenticated becomes false
- Use `renderHook` from `@testing-library/react` to test the `useAuth` hook
- Mock localStorage using `vi.spyOn(Storage.prototype, 'getItem')` and `vi.spyOn(Storage.prototype, 'setItem')`
  </action>
  <verify>
Run `cd frontend && npx vitest run` — all test files pass (6 test files total, 0 failures).
  </verify>
  <done>All 6 test files pass. CollectionCard tested with i18n, ProtectedRoute tested with auth states, AuthContext tested with localStorage mocking.</done>
</task>

</tasks>

<verification>
1. `cd frontend && npx vitest run` — exits with 0 failures across all 6 test files
2. `cd frontend && npm test -- --run` — same result via npm script
3. All test files use custom render utility (no bare `render` from RTL)
4. No hardcoded strings in test assertions — translations come from locale files via i18n mock
5. Zero ESLint warnings: `cd frontend && npm run lint`
</verification>

<success_criteria>
- `npm test -- --run` passes with 0 failures across 6 test files
- Custom render utility wraps components with i18n + Router providers
- Button tests cover all 4 variants + click handler + disabled + type default
- Badge tests cover all 4 status color variants + dot indicator
- CollectionCard tests cover title, photo count, date, cover image
- ProtectedRoute tests cover authenticated (renders children) and unauthenticated (redirects)
- AuthContext tests cover login/logout state transitions and localStorage persistence
</success_criteria>

<output>
After completion, create `.planning/phases/16-testing-and-qa/16-01-SUMMARY.md`
</output>
