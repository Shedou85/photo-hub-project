---
phase: 15-workflow-enhancement
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - frontend/src/components/collection/DraftPhase.jsx
  - frontend/src/components/collection/SelectingPhase.jsx
  - frontend/src/components/collection/ReviewingPhase.jsx
  - frontend/src/components/collection/DeliveredPhase.jsx
  - frontend/src/pages/CollectionDetailsPage.jsx
autonomous: true

must_haves:
  truths:
    - "CollectionDetailsPage uses separate phase components instead of inline conditional blocks"
    - "Primary action button changes per collection status (DRAFT: Share, SELECTING: Copy share link, REVIEWING: Mark delivered, DELIVERED: Copy delivery link)"
    - "Workflow phase selection uses object lookup pattern, not nested ternaries"
    - "Phase components use Button primitive from Phase 12"
    - "Page transitions and element transitions use 300ms or less animation duration"
  artifacts:
    - path: "frontend/src/components/collection/DraftPhase.jsx"
      provides: "DRAFT workflow phase UI with share link and conditional start-selecting"
      contains: "DraftPhase"
    - path: "frontend/src/components/collection/SelectingPhase.jsx"
      provides: "SELECTING workflow phase UI with share link copy"
      contains: "SelectingPhase"
    - path: "frontend/src/components/collection/ReviewingPhase.jsx"
      provides: "REVIEWING workflow phase UI with mark-as-delivered action"
      contains: "ReviewingPhase"
    - path: "frontend/src/components/collection/DeliveredPhase.jsx"
      provides: "DELIVERED/DOWNLOADED workflow phase UI with delivery link copy"
      contains: "DeliveredPhase"
    - path: "frontend/src/pages/CollectionDetailsPage.jsx"
      provides: "Refactored page using WORKFLOW_PHASES object lookup"
      contains: "WORKFLOW_PHASES"
  key_links:
    - from: "frontend/src/pages/CollectionDetailsPage.jsx"
      to: "frontend/src/components/collection/DraftPhase.jsx"
      via: "WORKFLOW_PHASES object lookup and dynamic component rendering"
      pattern: "WORKFLOW_PHASES\\[collection"
    - from: "frontend/src/components/collection/DraftPhase.jsx"
      to: "frontend/src/components/primitives/Button.jsx"
      via: "import Button for action buttons"
      pattern: "import Button"
    - from: "frontend/src/components/collection/ReviewingPhase.jsx"
      to: "frontend/src/components/primitives/Button.jsx"
      via: "import Button for mark-as-delivered button"
      pattern: "import Button"
---

<objective>
Extract workflow phase components from CollectionDetailsPage and implement object lookup pattern for status-based UI rendering.

Purpose: CollectionDetailsPage is 1,041 lines with interleaved workflow phase logic (Share/Review/Deliver sections). Extracting DraftPhase, SelectingPhase, ReviewingPhase, and DeliveredPhase components isolates phase-specific UI, makes the page readable, and uses the object lookup pattern (WORKFLOW-09) instead of nested conditionals. Phase components use the Button primitive from Phase 12.

Output: Four new workflow phase components in `components/collection/`, refactored CollectionDetailsPage using WORKFLOW_PHASES object lookup, Button primitive usage in extracted components, and Badge primitive usage in header.
</objective>

<execution_context>
@C:/Users/Marius/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Marius/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-workflow-enhancement/15-01-SUMMARY.md

@frontend/src/pages/CollectionDetailsPage.jsx
@frontend/src/components/primitives/Button.jsx
@frontend/src/components/primitives/Badge.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create workflow phase components</name>
  <files>
    frontend/src/components/collection/DraftPhase.jsx
    frontend/src/components/collection/SelectingPhase.jsx
    frontend/src/components/collection/ReviewingPhase.jsx
    frontend/src/components/collection/DeliveredPhase.jsx
  </files>
  <action>
Create the `frontend/src/components/collection/` directory and four workflow phase components. Each component receives props from CollectionDetailsPage and renders phase-specific actions.

**All phase components follow this pattern:**
- Import `useTranslation` from `react-i18next`
- Import `Button` from `../primitives/Button`
- Use JSDoc with `@param` documentation
- Use `function` declaration with default export
- Phase section header: `<h3>` with `text-xs font-semibold tracking-[0.06em] uppercase text-gray-400 mb-3`
- Action buttons wrapped in `<div className="flex gap-3 flex-wrap">`

**DraftPhase.jsx:**
```jsx
import { useTranslation } from 'react-i18next';
import Button from '../primitives/Button';

/**
 * DRAFT workflow phase — Share link + Start client selection
 *
 * @param {Object} props
 * @param {Object} props.collection - Collection object
 * @param {number} props.photoCount - Number of photos in collection
 * @param {Function} props.onCopyShareLink - Handler for copying share link
 * @param {Function} props.onStartSelecting - Handler for status transition to SELECTING
 */
function DraftPhase({ collection, photoCount, onCopyShareLink, onStartSelecting }) {
  const { t } = useTranslation();

  return (
    <div>
      <h3 className="text-xs font-semibold tracking-[0.06em] uppercase text-gray-400 mb-3">
        {t('collection.sharePhase')}
      </h3>
      <div className="flex gap-3 flex-wrap">
        <Button variant="primary" onClick={onCopyShareLink}>
          <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
          </svg>
          {t('collection.copyShareLink')}
        </Button>
        {/* WORKFLOW-03: Hide when no photos */}
        {photoCount > 0 && (
          <Button variant="secondary" onClick={onStartSelecting}>
            {t('collection.startSelecting')}
          </Button>
        )}
      </div>
    </div>
  );
}

export default DraftPhase;
```

**SelectingPhase.jsx:**
```jsx
import { useTranslation } from 'react-i18next';
import Button from '../primitives/Button';

/**
 * SELECTING workflow phase — Copy share link for client selections
 *
 * @param {Object} props
 * @param {Object} props.collection - Collection object
 * @param {Function} props.onCopyShareLink - Handler for copying share link
 */
function SelectingPhase({ collection, onCopyShareLink }) {
  const { t } = useTranslation();

  return (
    <div>
      <h3 className="text-xs font-semibold tracking-[0.06em] uppercase text-gray-400 mb-3">
        {t('collection.sharePhase')}
      </h3>
      <div className="flex gap-3 flex-wrap">
        <Button variant="primary" onClick={onCopyShareLink}>
          <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
          </svg>
          {t('collection.copyShareLink')}
        </Button>
      </div>
    </div>
  );
}

export default SelectingPhase;
```

**ReviewingPhase.jsx:**
```jsx
import { useTranslation } from 'react-i18next';
import Button from '../primitives/Button';

/**
 * REVIEWING workflow phase — Mark as delivered action
 *
 * @param {Object} props
 * @param {Object} props.collection - Collection object
 * @param {Function} props.onCopyShareLink - Handler for copying share link (view selections)
 * @param {Function} props.onMarkAsDelivered - Handler for marking collection as delivered
 * @param {number} props.editedPhotosCount - Number of edited photos uploaded
 */
function ReviewingPhase({ collection, onCopyShareLink, onMarkAsDelivered, editedPhotosCount }) {
  const { t } = useTranslation();

  return (
    <div className="space-y-4">
      {/* Share section (always visible for reference) */}
      <div>
        <h3 className="text-xs font-semibold tracking-[0.06em] uppercase text-gray-400 mb-3">
          {t('collection.sharePhase')}
        </h3>
        <div className="flex gap-3 flex-wrap">
          <Button variant="secondary" onClick={onCopyShareLink}>
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
            </svg>
            {t('collection.copyShareLink')}
          </Button>
        </div>
      </div>

      {/* Review section — primary action */}
      <div>
        <h3 className="text-xs font-semibold tracking-[0.06em] uppercase text-gray-400 mb-3">
          {t('collection.reviewPhase')}
        </h3>
        <div className="flex gap-3 flex-wrap">
          <Button
            variant="primary"
            onClick={onMarkAsDelivered}
            disabled={editedPhotosCount === 0}
          >
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" />
            </svg>
            {t('collection.markAsDelivered')}
          </Button>
        </div>
      </div>
    </div>
  );
}

export default ReviewingPhase;
```

**DeliveredPhase.jsx:**
Used for both DELIVERED and DOWNLOADED statuses (same UI per research recommendation).

```jsx
import { useTranslation } from 'react-i18next';
import Button from '../primitives/Button';

/**
 * DELIVERED/DOWNLOADED workflow phase — Copy delivery link
 *
 * @param {Object} props
 * @param {Object} props.collection - Collection object with deliveryToken
 * @param {Function} props.onCopyDeliveryLink - Handler for copying delivery link
 * @param {Function} props.onCopyShareLink - Handler for copying share link
 */
function DeliveredPhase({ collection, onCopyDeliveryLink, onCopyShareLink }) {
  const { t } = useTranslation();

  return (
    <div className="space-y-4">
      {/* Share section (reference) */}
      <div>
        <h3 className="text-xs font-semibold tracking-[0.06em] uppercase text-gray-400 mb-3">
          {t('collection.sharePhase')}
        </h3>
        <div className="flex gap-3 flex-wrap">
          <Button variant="secondary" onClick={onCopyShareLink}>
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
            </svg>
            {t('collection.copyShareLink')}
          </Button>
        </div>
      </div>

      {/* Deliver section — primary action */}
      <div>
        <h3 className="text-xs font-semibold tracking-[0.06em] uppercase text-gray-400 mb-3">
          {t('collection.deliverPhase')}
        </h3>
        <div className="flex gap-3 flex-wrap">
          {collection.deliveryToken && (
            <Button variant="primary" onClick={onCopyDeliveryLink}>
              <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              {t('collection.copyDeliveryLink')}
            </Button>
          )}
        </div>
      </div>
    </div>
  );
}

export default DeliveredPhase;
```

**Important styling note for all phase components:**
- Use `Button` primitive (`variant="primary"` for primary actions, `variant="secondary"` for secondary actions) — NOT inline `<button>` with gradient classes. This replaces the current inline gradient button styles (lines 650-666) with the Phase 12 primitive.
- In ReviewingPhase, the "Mark as Delivered" button uses `Button variant="primary"` — the old code had a custom green gradient (`bg-[linear-gradient(135deg,#10b981,#059669)]`). Now it uses the standard primary gradient per the design system. This is intentional: the Button primitive provides consistent styling.
- The `disabled` prop on Button primitive already handles `opacity-50 cursor-not-allowed` styling.
  </action>
  <verify>
  - All 4 files exist in `frontend/src/components/collection/`
  - Each file imports `Button` from `../primitives/Button`
  - Each file imports `useTranslation` from `react-i18next`
  - Each file has JSDoc documentation
  - `npm run lint` — zero errors
  </verify>
  <done>
  - DraftPhase renders share link + conditional start-selecting buttons using Button primitive
  - SelectingPhase renders share link copy button
  - ReviewingPhase renders share link (secondary) + mark-as-delivered (primary) with disabled state
  - DeliveredPhase renders share link (secondary) + delivery link copy (primary) with deliveryToken check
  - All components use Button primitive, not inline button elements
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor CollectionDetailsPage to use workflow phase components with object lookup</name>
  <files>
    frontend/src/pages/CollectionDetailsPage.jsx
  </files>
  <action>
**Refactor CollectionDetailsPage.jsx to use the extracted phase components:**

1. **Add imports** at top of file (after existing imports):
   ```jsx
   import Button from '../components/primitives/Button';
   import Badge from '../components/primitives/Badge';
   import DraftPhase from '../components/collection/DraftPhase';
   import SelectingPhase from '../components/collection/SelectingPhase';
   import ReviewingPhase from '../components/collection/ReviewingPhase';
   import DeliveredPhase from '../components/collection/DeliveredPhase';
   ```

2. **Create WORKFLOW_PHASES object lookup** (WORKFLOW-05, WORKFLOW-09) — place this OUTSIDE the component function, above `function CollectionDetailsPage()`:
   ```jsx
   const WORKFLOW_PHASES = {
     DRAFT: DraftPhase,
     SELECTING: SelectingPhase,
     REVIEWING: ReviewingPhase,
     DELIVERED: DeliveredPhase,
     DOWNLOADED: DeliveredPhase,
   };
   ```

3. **Replace the Actions Card with Workflow Phases** (lines 642-716). Remove the entire `{/* ── Actions Card with Workflow Phases ── */}` div and replace with:
   ```jsx
   {/* ── Workflow Phase Actions ── */}
   {(() => {
     const PhaseComponent = WORKFLOW_PHASES[collection.status];
     if (!PhaseComponent) return null;
     return (
       <div className="bg-white border border-gray-200 rounded px-6 py-5 mb-5">
         <PhaseComponent
           collection={collection}
           photoCount={photos.length}
           onCopyShareLink={handleCopyShareLink}
           onCopyDeliveryLink={handleCopyDeliveryLink}
           onStartSelecting={handleStartSelecting}
           onMarkAsDelivered={handleMarkAsDelivered}
           editedPhotosCount={editedPhotos.length}
         />
       </div>
     );
   })()}
   ```

   This replaces ~75 lines of nested conditional JSX with a clean 12-line object lookup. The IIFE is used to avoid adding a new variable inside JSX. Alternative: compute `PhaseComponent` in the render body above the return, then use `{PhaseComponent && <div ...><PhaseComponent ... /></div>}` in JSX — either approach is fine. Choose whichever reads better.

4. **Replace the inline status badge in the page header** (lines 611-621). Currently uses inline conditional classes for status colors. Replace with the Badge primitive:

   Change:
   ```jsx
   {collection.status !== 'DRAFT' && (
     <span className={`inline-block text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full ${
       collection.status === 'SELECTING' ? 'bg-blue-100 text-blue-700' :
       collection.status === 'REVIEWING' ? 'bg-green-100 text-green-700' :
       collection.status === 'DELIVERED' ? 'bg-purple-100 text-purple-700' :
       collection.status === 'DOWNLOADED' ? 'bg-purple-200 text-purple-800' :
       'bg-gray-100 text-gray-600'
     }`}>
       {t(`collection.status.${collection.status}`)}
     </span>
   )}
   ```

   To:
   ```jsx
   {collection.status !== 'DRAFT' && (
     <Badge status={collection.status}>
       {t(`collection.status.${collection.status}`)}
     </Badge>
   )}
   ```

5. **Replace the "Add More Photos" inline button** (lines 757-765) with the Button primitive:

   Change:
   ```jsx
   <button
     onClick={() => fileInputRef.current?.click()}
     className="inline-flex items-center gap-2 py-2.5 px-5 text-sm font-semibold text-blue-600 bg-blue-50 border border-blue-200 rounded-sm hover:bg-blue-100 transition-colors cursor-pointer font-sans"
   >
     <svg ...>...</svg>
     {t('collection.addMorePhotos')}
   </button>
   ```

   To:
   ```jsx
   <Button variant="secondary" onClick={() => fileInputRef.current?.click()}>
     <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
       <path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" />
     </svg>
     {t('collection.addMorePhotos')}
   </Button>
   ```

6. **Add transition-all duration-300 to the upload zone** (QUALITY-06) — the full dropzone div (line 740) already has `transition-colors`. Update it to `transition-all duration-300` to meet the animation budget requirement. This ensures any property changes (opacity, color, border) animate within 300ms.

7. **Verify WORKFLOW-01 and WORKFLOW-02 are intact**: The progressive disclosure upload zone (photos.length === 0 ? fullDropzone : compactButton pattern at lines 730-766) should remain unchanged by this refactor. Confirm the conditional render logic still works after removing the actions card above it.

**What NOT to change:**
- Upload logic (uploadFiles, handleFileChange, handleDrop, etc.) stays in CollectionDetailsPage
- Photo grid, lightbox, filter tabs — all stay in CollectionDetailsPage
- Edited finals upload zone (REVIEWING only) — stays in CollectionDetailsPage
- All state management (useState, useEffect, useCallback, useMemo) stays in CollectionDetailsPage
- The phase components are PRESENTATIONAL — they receive handlers as props, they don't manage state
  </action>
  <verify>
  - `npm run lint` from `frontend/` — zero errors
  - `npm run build` from `frontend/` — successful production build
  - Grep for `WORKFLOW_PHASES` in CollectionDetailsPage.jsx returns matches
  - Grep for `DraftPhase` in CollectionDetailsPage.jsx returns import match
  - Grep for `Badge` import in CollectionDetailsPage.jsx returns match
  - Grep for `Button` import in CollectionDetailsPage.jsx returns match
  - No more inline `bg-[linear-gradient(135deg,#3b82f6` on button elements inside the actions card (replaced by Button primitive)
  - No more inline status badge color classes in the page header (replaced by Badge primitive)
  - `transition-all duration-300` present on upload zone dropzone div
  </verify>
  <done>
  - CollectionDetailsPage uses WORKFLOW_PHASES object lookup to render phase-specific components
  - 4 phase components (DraftPhase, SelectingPhase, ReviewingPhase, DeliveredPhase) render workflow actions
  - Badge primitive replaces inline status badge in page header
  - Button primitive replaces inline "Add More Photos" button
  - Upload zone has transition-all duration-300 for animation budget compliance
  - CollectionDetailsPage reduced by ~60 lines through component extraction
  - No regressions in upload, photo grid, lightbox, or filter functionality
  </done>
</task>

</tasks>

<verification>
- `npm run lint` — zero errors
- `npm run build` — successful production build
- 4 phase component files exist in `frontend/src/components/collection/`
- CollectionDetailsPage imports and uses all 4 phase components
- WORKFLOW_PHASES object maps status strings to components (no nested ternaries)
- Badge primitive used for status badge in page header
- Button primitive used in all phase components and "Add More Photos" button
- Upload zone has `duration-300` class for animation budget
- No inline gradient button classes remain in the actions card section
</verification>

<success_criteria>
1. CollectionDetailsPage uses WORKFLOW_PHASES[collection.status] to render phase components
2. DraftPhase shows "Copy share link" (primary) + "Start client selection" (secondary, hidden when 0 photos)
3. SelectingPhase shows "Copy share link" (primary)
4. ReviewingPhase shows "Copy share link" (secondary) + "Mark as Delivered" (primary, disabled when 0 edited photos)
5. DeliveredPhase shows "Copy share link" (secondary) + "Copy delivery link" (primary)
6. Badge primitive renders status badge in header (replaces inline color classes)
7. Button primitive renders "Add More Photos" (replaces inline button)
8. Upload zone transitions use 300ms or less
9. Zero lint errors, production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/15-workflow-enhancement/15-02-SUMMARY.md`
</output>
