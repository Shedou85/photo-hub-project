---
phase: 02-sharing-and-status
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/pages/CollectionsListPage.jsx
  - frontend/src/pages/CollectionDetailsPage.jsx
  - frontend/src/locales/en.json
  - frontend/src/locales/lt.json
  - frontend/src/locales/ru.json
autonomous: false

must_haves:
  truths:
    - "Collection cards on the list page show a blue border when status is SELECTING"
    - "Collection cards on the list page show a green border when status is REVIEWING"
    - "Photographer can transition a collection from DRAFT to SELECTING on the detail page"
    - "Status badge is visible on collection cards indicating current status"
  artifacts:
    - path: "frontend/src/pages/CollectionsListPage.jsx"
      provides: "Status-conditional border colors and status badge on collection cards"
      contains: "SELECTING"
    - path: "frontend/src/pages/CollectionDetailsPage.jsx"
      provides: "Status display and transition button to SELECTING"
      contains: "SELECTING"
  key_links:
    - from: "frontend/src/pages/CollectionsListPage.jsx"
      to: "collection.status"
      via: "conditional Tailwind border class based on status value"
      pattern: "SELECTING.*border-blue|border-blue.*SELECTING"
    - from: "frontend/src/pages/CollectionDetailsPage.jsx"
      to: "PATCH /collections/{id}"
      via: "fetch PATCH with status: SELECTING"
      pattern: "status.*SELECTING"
---

<objective>
Add status color coding to collection cards (blue=SELECTING, green=REVIEWING) and a status transition button on the collection detail page so the photographer can move a collection from DRAFT to SELECTING when ready to share.

Purpose: Delivers SHARE-03 (collection cards display status color). Also adds the ability for the photographer to activate sharing by transitioning to SELECTING status, which is necessary for the Phase 3 client selection workflow. The PATCH /collections/{id} endpoint already supports status updates — this plan wires the frontend.

Output: Updated `CollectionsListPage.jsx` with status borders and badges, updated `CollectionDetailsPage.jsx` with status display and transition button, i18n keys in all 3 locale files.
</objective>

<execution_context>
@C:/Users/Marius/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Marius/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-sharing-and-status/02-RESEARCH.md
@.planning/phases/02-sharing-and-status/02-01-SUMMARY.md

Key existing code:
- frontend/src/pages/CollectionsListPage.jsx — line 212: card div has `className="bg-white rounded-[10px] shadow-md ..."`. Currently no border class. Add status-conditional border.
- frontend/src/pages/CollectionDetailsPage.jsx — already has collection state with `collection.status`. Needs status display in info card and transition button.
- backend/collections/id.php — PATCH handler already accepts `status` field and validates against `['DRAFT', 'SELECTING', 'REVIEWING', 'DELIVERED', 'ARCHIVED']`. No backend changes needed.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Status color coding on collection cards and status transition on detail page</name>
  <files>frontend/src/pages/CollectionsListPage.jsx, frontend/src/pages/CollectionDetailsPage.jsx, frontend/src/locales/en.json, frontend/src/locales/lt.json, frontend/src/locales/ru.json</files>
  <action>
**1. Collection card status borders in `CollectionsListPage.jsx`:**

Add a status-to-border mapping constant at the top of the component (inside the function, before the return):
```jsx
const STATUS_BORDER = {
  SELECTING: 'border-2 border-blue-500',
  REVIEWING: 'border-2 border-green-500',
};
```

On the card div (currently `className="bg-white rounded-[10px] shadow-md hover:shadow-lg overflow-hidden group ..."`), conditionally apply the border:
```jsx
const statusBorder = STATUS_BORDER[collection.status] ?? '';
```

Add `${statusBorder}` to the card's className. The card currently has no explicit border, so there is no class conflict.

**Also add a small status badge** to each collection card, below the date line in the text area. Use a pill-style badge:
```jsx
{collection.status !== 'DRAFT' && (
  <span className={`inline-block text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full ${
    collection.status === 'SELECTING' ? 'bg-blue-100 text-blue-700' :
    collection.status === 'REVIEWING' ? 'bg-green-100 text-green-700' :
    collection.status === 'DELIVERED' ? 'bg-purple-100 text-purple-700' :
    'bg-gray-100 text-gray-600'
  }`}>
    {t(`collections.status.${collection.status}`)}
  </span>
)}
```

Place this badge between the date `<p>` and the button row `<div className="flex gap-1.5">` in the card's text area.

**2. Status display and transition button in `CollectionDetailsPage.jsx`:**

In the collection info card (the first `<div className="bg-white border border-gray-200 rounded-[10px] px-6 py-5 mb-5">` block), add:

a) An `InfoRow` showing the current status:
```jsx
<InfoRow
  label={t("collection.statusLabel")}
  value={t(`collection.status.${collection.status}`)}
/>
```

b) A status transition button. When status is DRAFT, show a button to transition to SELECTING ("Start client selection" / "Enable sharing"):
```jsx
{collection.status === 'DRAFT' && (
  <button
    onClick={handleStartSelecting}
    className="mt-4 inline-flex items-center gap-2 py-[9px] px-[22px] text-[14px] font-semibold text-white bg-[linear-gradient(135deg,#3b82f6,#6366f1)] border-none rounded-[6px] cursor-pointer font-sans transition-opacity duration-150 hover:opacity-[0.88]"
  >
    {t('collection.startSelecting')}
  </button>
)}
```

c) Add the `handleStartSelecting` function:
```jsx
const handleStartSelecting = async () => {
  try {
    const res = await fetch(
      `${import.meta.env.VITE_API_BASE_URL}/collections/${id}`,
      {
        method: 'PATCH',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status: 'SELECTING' }),
      }
    );
    if (res.ok) {
      const data = await res.json();
      if (data.status === 'OK') {
        setCollection(data.collection);
        toast.success(t('collection.statusUpdated'));
      }
    } else {
      toast.error(t('collection.statusUpdateError'));
    }
  } catch {
    toast.error(t('collection.statusUpdateError'));
  }
};
```

d) Show a status badge in the page header area (next to the collection name) using the same pill style from the collection cards.

**3. Add i18n keys to ALL THREE locale files:**

**en.json** — add to `"collections"` namespace (for card badges) and `"collection"` namespace (for detail page):
```json
"collections": {
  ... (existing keys),
  "status": {
    "DRAFT": "Draft",
    "SELECTING": "Selecting",
    "REVIEWING": "Reviewing",
    "DELIVERED": "Delivered",
    "ARCHIVED": "Archived"
  }
}
```
```json
"collection": {
  ... (existing keys),
  "statusLabel": "Status",
  "status": {
    "DRAFT": "Draft",
    "SELECTING": "Selecting",
    "REVIEWING": "Reviewing",
    "DELIVERED": "Delivered",
    "ARCHIVED": "Archived"
  },
  "startSelecting": "Start client selection",
  "statusUpdated": "Collection status updated!",
  "statusUpdateError": "Failed to update status. Please try again."
}
```

**lt.json** — add equivalent keys:
```json
"collections.status": {
  "DRAFT": "Juodraštis",
  "SELECTING": "Atranka",
  "REVIEWING": "Peržiūra",
  "DELIVERED": "Pristatyta",
  "ARCHIVED": "Archyvuota"
}
"collection.statusLabel": "Būsena"
"collection.status": same values as collections.status
"collection.startSelecting": "Pradėti klientų atranką"
"collection.statusUpdated": "Kolekcijos būsena atnaujinta!"
"collection.statusUpdateError": "Nepavyko atnaujinti būsenos. Bandykite dar kartą."
```

**ru.json** — add equivalent keys:
```json
"collections.status": {
  "DRAFT": "Черновик",
  "SELECTING": "Отбор",
  "REVIEWING": "Рассмотрение",
  "DELIVERED": "Доставлена",
  "ARCHIVED": "Архив"
}
"collection.statusLabel": "Статус"
"collection.status": same values as collections.status
"collection.startSelecting": "Начать отбор клиентом"
"collection.statusUpdated": "Статус коллекции обновлён!"
"collection.statusUpdateError": "Не удалось обновить статус. Попробуйте ещё раз."
```

Note: The above i18n snippets show the nested structure. In the actual JSON files, nest them properly within their parent namespace objects.
  </action>
  <verify>
1. `cd frontend && npm run lint` — passes with zero warnings.
2. `cd frontend && npm run build` — builds without errors.
3. Visual: collection cards with SELECTING status show blue border; REVIEWING show green border; DRAFT show no border.
  </verify>
  <done>
Collection cards show status-conditional borders (blue for SELECTING, green for REVIEWING). Status badges visible on non-DRAFT cards. Detail page shows current status, has transition button for DRAFT → SELECTING. All i18n keys in all 3 locale files. ESLint and build pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of share flow and status colors</name>
  <what-built>
Complete Phase 2: share link generation, public share page, and status color coding on collection cards.
  </what-built>
  <how-to-verify>
**Share flow verification:**
1. Navigate to any collection detail page at `/collection/{id}`.
2. Verify a "Copy share link" button is visible in the info card.
3. Click the button — a toast should confirm the link was copied.
4. Open a new incognito/private browser window (no session cookies).
5. Paste the share URL — the public share page should load showing collection name, photo count, and thumbnail grid.
6. Click a thumbnail — lightbox should open with prev/next navigation and close button.
7. Verify no sidebar or login prompt appears on the share page.

**Status color verification:**
8. On the collection detail page, if the collection is DRAFT, click "Start client selection" button.
9. Verify the status changes to SELECTING (status badge updates).
10. Navigate back to /collections list.
11. Verify the collection card now has a blue border and a "Selecting" status badge.
12. Verify other DRAFT collections have no colored border.

**Edge cases:**
13. Visit `/share/invalidtoken123` — should show a "not found" message, not crash.
14. Refresh the share page — should still load correctly.
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
1. Collection cards: SELECTING → blue border-2 border-blue-500, REVIEWING → green border-2 border-green-500, DRAFT → no colored border.
2. Status badges on cards show translated status text for non-DRAFT collections.
3. Detail page info card shows status label and current status value.
4. Detail page has "Start client selection" button when status is DRAFT; clicking it PATCHes status to SELECTING.
5. All i18n keys (status names, button labels, feedback messages) in en.json, lt.json, ru.json.
6. ESLint passes. Build succeeds.
7. Human verification confirms visual correctness of the entire Phase 2 feature set (share flow + status colors).
</verification>

<success_criteria>
- Collection cards on the list page show blue border for SELECTING and green border for REVIEWING status.
- Status badge displays on non-DRAFT collection cards.
- Photographer can transition from DRAFT to SELECTING on the detail page.
- All strings internationalized in EN, LT, RU.
- ESLint and build pass.
- Human verification approved.
</success_criteria>

<output>
After completion, create `.planning/phases/02-sharing-and-status/02-02-SUMMARY.md`
</output>
