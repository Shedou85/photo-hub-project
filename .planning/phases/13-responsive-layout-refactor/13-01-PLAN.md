---
phase: 13-responsive-layout-refactor
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/hooks/useMediaQuery.js
  - frontend/src/components/BottomNavigation.jsx
  - frontend/src/layouts/MobileLayout.jsx
  - frontend/src/layouts/ResponsiveLayout.jsx
  - frontend/src/layouts/MainLayout.jsx
  - frontend/src/App.jsx
  - frontend/index.html
  - frontend/src/locales/en.json
  - frontend/src/locales/lt.json
  - frontend/src/locales/ru.json
autonomous: true

must_haves:
  truths:
    - "Mobile (<768px) renders bottom tab navigation with 3 core actions (Collections, Profile, Payments)"
    - "Desktop (>=768px) renders persistent left sidebar navigation (256px wide)"
    - "Bottom nav touch targets are minimum 48x48px (implemented as 56x56px)"
    - "iOS safe area padding applied to bottom navigation via env(safe-area-inset-bottom)"
    - "Mobile layout does NOT show hamburger menu or slide-in sidebar"
  artifacts:
    - path: "frontend/src/hooks/useMediaQuery.js"
      provides: "Custom hook for runtime breakpoint detection using window.matchMedia"
      exports: ["default"]
    - path: "frontend/src/components/BottomNavigation.jsx"
      provides: "Mobile bottom tab bar with 3 nav items and 56x56px touch targets"
      exports: ["default"]
    - path: "frontend/src/layouts/MobileLayout.jsx"
      provides: "Mobile layout shell with bottom nav and content padding"
      exports: ["default"]
    - path: "frontend/src/layouts/ResponsiveLayout.jsx"
      provides: "Conditional layout switcher (MainLayout vs MobileLayout)"
      exports: ["default"]
  key_links:
    - from: "frontend/src/layouts/ResponsiveLayout.jsx"
      to: "frontend/src/hooks/useMediaQuery.js"
      via: "useMediaQuery hook call with BREAKPOINTS.TABLET"
      pattern: "useMediaQuery.*min-width.*768"
    - from: "frontend/src/App.jsx"
      to: "frontend/src/layouts/ResponsiveLayout.jsx"
      via: "Route element wrapping authenticated routes"
      pattern: "<ResponsiveLayout"
    - from: "frontend/src/layouts/MobileLayout.jsx"
      to: "frontend/src/components/BottomNavigation.jsx"
      via: "BottomNavigation rendered inside MobileLayout"
      pattern: "<BottomNavigation"
---

<objective>
Create the responsive layout infrastructure: useMediaQuery hook, mobile bottom tab navigation, MobileLayout shell, and ResponsiveLayout switcher. Refactor MainLayout for desktop-only use with 256px sidebar.

Purpose: Establish the dual-layout system (mobile bottom nav vs desktop sidebar) required by LAYOUT-01, LAYOUT-02, LAYOUT-03, and LAYOUT-07 before page-level grid refactors in Plan 02.
Output: 4 new files (hook, component, 2 layouts) + updated MainLayout, App.jsx, index.html, and locale files.
</objective>

<execution_context>
@C:/Users/Marius/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Marius/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key existing files
@frontend/src/layouts/MainLayout.jsx
@frontend/src/App.jsx
@frontend/src/constants/breakpoints.js
@frontend/index.html
@frontend/src/locales/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useMediaQuery hook and mobile layout infrastructure</name>
  <files>
    frontend/src/hooks/useMediaQuery.js
    frontend/src/components/BottomNavigation.jsx
    frontend/src/layouts/MobileLayout.jsx
    frontend/src/layouts/ResponsiveLayout.jsx
  </files>
  <action>
Create 4 new files:

**1. `frontend/src/hooks/useMediaQuery.js`**
Custom hook wrapping `window.matchMedia()` for runtime responsive logic. Initialize state synchronously from current matchMedia result (SSR-safe with typeof window check). Use `addEventListener('change', handler)` (NOT deprecated `.addListener()`). Return cleanup function in useEffect. ~20 lines.

```js
import { useState, useEffect } from 'react';

function useMediaQuery(query) {
  const [matches, setMatches] = useState(() => {
    if (typeof window !== 'undefined') {
      return window.matchMedia(query).matches;
    }
    return false;
  });

  useEffect(() => {
    const mediaQuery = window.matchMedia(query);
    const handleChange = (event) => setMatches(event.matches);
    mediaQuery.addEventListener('change', handleChange);
    return () => mediaQuery.removeEventListener('change', handleChange);
  }, [query]);

  return matches;
}

export default useMediaQuery;
```

**2. `frontend/src/components/BottomNavigation.jsx`**
Mobile bottom tab bar with 3 items: Collections, Profile, Payments.
- Fixed position `bottom-0 left-0 right-0` with `bg-white border-t border-gray-200 z-50`
- Use inline `style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}` for iOS home indicator (this is the one exception where inline style is necessary — CSS env() function)
- Each nav item: `Link` from react-router-dom with `min-w-[56px] min-h-[56px]` touch target (exceeds WCAG 48px minimum)
- Active state: `text-blue-600 bg-blue-50`, inactive: `text-gray-500 hover:bg-gray-50`
- Icon: Use simple SVG icons (NOT emoji — emojis render inconsistently cross-platform). Use 24px SVG icons for: grid/folder icon (Collections), user icon (Profile), credit-card icon (Payments)
- Label: `text-[10px] font-semibold uppercase tracking-wider`
- Use `useLocation()` for active state detection and `useTranslation()` for labels
- Add `role="navigation"` and `aria-label={t('nav.mainNavigation')}` for accessibility
- Add `aria-current="page"` on active link

**3. `frontend/src/layouts/MobileLayout.jsx`**
Mobile layout shell:
- `<div className="flex flex-col min-h-screen bg-surface-light">`
- Top header bar: `<header className="flex items-center justify-between px-4 py-3 bg-white border-b border-gray-200 sticky top-0 z-40">` with PixelForge logo on left, language switcher on right
- Language switcher: Extract from MainLayout.jsx — same dropdown logic (languages array, langOpen state, langDropdownRef, currentLang detection, i18n.changeLanguage). Use same styling classes as MainLayout's language switcher.
- Main content: `<main className="flex-1 p-4 pb-24"><Outlet /></main>` — pb-24 (96px) prevents content from hiding under fixed bottom nav
- `<BottomNavigation />` at the end
- Import Outlet from react-router-dom

**4. `frontend/src/layouts/ResponsiveLayout.jsx`**
Conditional layout switcher:
- Import useMediaQuery from hooks, BREAKPOINTS from constants
- `const isDesktop = useMediaQuery('(min-width: ${BREAKPOINTS.TABLET}px)');` — use template literal to build query string
- Return `isDesktop ? <MainLayout /> : <MobileLayout />`
- Use string interpolation with backticks: `` `(min-width: ${BREAKPOINTS.TABLET}px)` ``

Add JSDoc comments to all 4 files following the Phase 12 convention (@param, @returns, @example).
  </action>
  <verify>
Run `cd frontend && npx eslint src/hooks/useMediaQuery.js src/components/BottomNavigation.jsx src/layouts/MobileLayout.jsx src/layouts/ResponsiveLayout.jsx --max-warnings 0` — zero errors.
Run `cd frontend && npm run build` — no build errors.
  </verify>
  <done>
4 new files exist with JSDoc documentation. useMediaQuery hook uses window.matchMedia with proper cleanup. BottomNavigation has 3 items with 56x56px touch targets and iOS safe area support. MobileLayout has bottom nav + content padding + language switcher. ResponsiveLayout conditionally renders based on 768px breakpoint.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor MainLayout for desktop-only, update App.jsx routing, and add i18n keys</name>
  <files>
    frontend/src/layouts/MainLayout.jsx
    frontend/src/App.jsx
    frontend/index.html
    frontend/src/locales/en.json
    frontend/src/locales/lt.json
    frontend/src/locales/ru.json
  </files>
  <action>
**1. Refactor `frontend/src/layouts/MainLayout.jsx` for desktop-only use:**
- Change `SIDEBAR_WIDTH` from 240 to 256 (requirement LAYOUT-02: 256px wide)
- Remove ALL mobile-specific code:
  - Remove `isMobile` state and the resize event listener useEffect
  - Remove `sidebarOpen` state and `setSidebarOpen` calls
  - Remove the mobile top bar `<header>` block (lines 79-90)
  - Remove the mobile overlay `<div>` (lines 96-101)
  - Remove the `isMobile ? ' fixed' : ' sticky'` ternary on sidebar className — sidebar is always `sticky`
  - Remove the `left: isMobile ? (sidebarOpen ? 0 : -SIDEBAR_WIDTH) : 0` — sidebar is always visible at `left: 0`
  - Remove the mobile sidebar shadow logic
  - Remove the sidebar close button (only shown when `isMobile`)
  - Remove the `useEffect` that closes sidebar on location change
  - Remove `useState` import if no longer needed (langOpen still needs it)
  - Remove the `isMobile ? 'p-4' : 'py-7 px-8'` ternary on main — always use desktop padding `'py-7 px-8'`
- Keep: Language switcher, nav items, logout button, sidebar header with user info, sidebar footer
- Keep: `useEffect` for langDropdownRef mousedown outside-click handler
- The sidebar should now be simple: always visible, sticky, 256px wide, no animations, no toggling

**2. Update `frontend/src/App.jsx`:**
- Replace `import MainLayout from './layouts/MainLayout'` with `import ResponsiveLayout from './layouts/ResponsiveLayout'`
- Change `<Route element={<ProtectedRoute><MainLayout /></ProtectedRoute>}>` to `<Route element={<ProtectedRoute><ResponsiveLayout /></ProtectedRoute>}>`
- This is the ONLY routing change needed — ResponsiveLayout handles the conditional rendering internally

**3. Update `frontend/index.html`:**
- Change the viewport meta tag from:
  `<meta name="viewport" content="width=device-width, initial-scale=1.0" />`
  to:
  `<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />`
- The `viewport-fit=cover` enables `env(safe-area-inset-bottom)` on iOS for the bottom navigation

**4. Add i18n keys to ALL 3 locale files:**
Add `"mainNavigation": "Main navigation"` under the `nav` namespace in en.json.
Add corresponding translations:
- lt.json: `"mainNavigation": "Pagrindinis meniu"`
- ru.json: `"mainNavigation": "Основная навигация"`

These keys are used by BottomNavigation's `aria-label={t('nav.mainNavigation')}`.
  </action>
  <verify>
Run `cd frontend && npm run lint` — zero warnings/errors.
Run `cd frontend && npm run build` — successful production build.
Verify `grep -c "ResponsiveLayout" frontend/src/App.jsx` returns at least 2 (import + usage).
Verify `grep "viewport-fit=cover" frontend/index.html` finds the updated meta tag.
Verify `grep "SIDEBAR_WIDTH = 256" frontend/src/layouts/MainLayout.jsx` confirms width update.
Verify `grep "isMobile" frontend/src/layouts/MainLayout.jsx` returns 0 matches (all mobile code removed).
  </verify>
  <done>
MainLayout is desktop-only with 256px sidebar, no mobile code. App.jsx routes through ResponsiveLayout. index.html has viewport-fit=cover for iOS safe area support. All 3 locale files have nav.mainNavigation key.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Build verification:** `cd frontend && npm run build` succeeds without errors
2. **Lint verification:** `cd frontend && npm run lint` passes with zero warnings
3. **File existence:** All 4 new files exist in expected locations:
   - `frontend/src/hooks/useMediaQuery.js`
   - `frontend/src/components/BottomNavigation.jsx`
   - `frontend/src/layouts/MobileLayout.jsx`
   - `frontend/src/layouts/ResponsiveLayout.jsx`
4. **Mobile code removed:** No `isMobile`, `sidebarOpen`, or hamburger references in MainLayout.jsx
5. **Desktop sidebar width:** MainLayout.jsx uses `SIDEBAR_WIDTH = 256`
6. **Route integration:** App.jsx imports and uses ResponsiveLayout (not MainLayout directly)
7. **iOS support:** index.html has `viewport-fit=cover` in meta viewport tag
8. **i18n complete:** All 3 locale files have `nav.mainNavigation` key
</verification>

<success_criteria>
- ResponsiveLayout conditionally renders MobileLayout (<768px) or MainLayout (>=768px) based on useMediaQuery hook
- Mobile bottom navigation has 3 items with 56x56px touch targets and iOS safe area padding
- Desktop sidebar is 256px wide, persistent, no mobile toggle code
- All files pass lint and build
- i18n keys added to all 3 locales
</success_criteria>

<output>
After completion, create `.planning/phases/13-responsive-layout-refactor/13-01-SUMMARY.md`
</output>
