================================================================================
                    PHOTO HUB (pixelforge.pro) — PROJEKTO APZVALGA
                              2026-02-26
================================================================================

Bendra ivertinimas: 8/10 — solidus projektas, bet yra zenkliu spragu.

Atnaujinta: 2026-02-26 — dauguma problemu istaisyta (zr. [ISTAISYTA] zymes).

================================================================================
1. KRITINES PROBLEMOS (turi buti istaisytos)
================================================================================

1.1. database_schema.sql nesinchronizuotas su kodu              [ISTAISYTA]
-----------------------------------------------------
Truksta 3 stulpeliu, kurie naudojami PHP kode:

- User.emailVerificationTokenExpires
- Collection.sourceFolder
- Collection.lightroomPath

SPRENDIMAS: Visi 3 stulpeliai prideti i database_schema.sql.
Taip pat issvalytos ~150 eiluciu pasenuusiu ALTER TABLE komentaru.

1.2. Nera 404 puslapio                                          [ISTAISYTA]
-----------------------------------------------------
SPRENDIMAS: Sukurtas NotFoundPage.jsx su i18n (LT/EN/RU).
Pridetas <Route path="*" /> catch-all App.jsx.

1.3. PaymentsPage — tik stub                                    [PRALEIDTA]
-----------------------------------------------------
Rodo plano korteles su "Coming soon" mygtukais.
Stripe mokejimui integracija — atskiras milestones.


================================================================================
2. SAUGUMO SPRAGOS (vidutinio lygio)
================================================================================

2.1. Nera CSP (Content-Security-Policy) header                  [PRALEIDTA]
  Atskiras task — reikia kruopsciai sukonfiguruoti del Google OAuth,
  inline stiliu ir kitu issimtimu.

2.2. Rate limiter failu pagrindu                                 [PRIIMTINA]
  Naudoja /tmp/photohub_ratelimit/ failus.
  Veikia teisingai vieno serverio aplinkoje (Hostinger shared hosting).
  Pereiti prie Redis kai bus kelis serveriai.

2.3. Delivery endpoints be rate limitingo                        [ISTAISYTA]
  SPRENDIMAS: Pridetas rate limiting:
  - photo-download: 60 req/15min per IP
  - zip-download: 10 req/15min per IP

2.4. Kolekciju galiojimas neuztikinamas                          [ISTAISYTA]
  SPRENDIMAS: expiresAt tikrinimas pridetas i:
  - deliver-view.php
  - photo-download.php
  - zip-download.php
  - share.php (GET ir PATCH)
  Pasibaigusios kolekcijos grazina HTTP 410 Gone.

2.5. Sesijos timeout 30 min                                      [PERZIURETA]
  SPRENDIMAS: 30 min yra tinkamas — dokumentuota prieszastis session.php:
  - Pakankamai trumpas kliento duomenu apsaugai
  - Pakankamai ilgas fotografo darbo sesijoms
  - Atitinka industrijos standartus


================================================================================
3. NEBAIGTOS FUNKCIJOS
================================================================================

3.1. Mokejimai (Stripe)                                         [PRALEIDTA]
  Atskiras milestone — PaymentsPage stub paliekamas.

3.2. SharePage slaptazodzio apsauga                              [PASALINTA]
  Pasalinta is plano — passwordless by design.
  Klientas turi galeti perziureti nuotraukas be papildomu kliuciu.

3.3. Lightroom integracija                                       [ISTAISYTA]
  SPRENDIMAS: lightroomScript.js istrintas (dead code).
  sourceFolder ir lightroomPath laukai paliekami — naudojami copyScript.js.

3.4. Promotional nuotrauku pertvarkymas                          [ISTAISYTA]
  SPRENDIMAS: Pridetas PATCH metodas promotional.php.
  Priima { order: [{ photoId, order }, ...] } — atnaujina eiles tvarka transakcijoje.

3.5. Download analytics                                          [ISTAISYTA]
  SPRENDIMAS: Sukurtas GET /admin/download-stats endpoint.
  Per-kolekcija statistika: ZIP/individual counts, datos, filtravimas.

3.6. Bulk operacijos                                             [LIKO]
  Negalima istrinti keliu nuotrauku vienu requestu.
  Negalima pakeisti keliu kolekciju statuso vienu metu.
  Zemesnis prioritetas — single operations veikia gerai.

3.7. ZIP atsisiuntimas UI                                        [JAU BUVO]
  Mygtukas jau implementuotas DeliveryPage.jsx (eilutes 203-223).
  Backend endpoint veikia su ZipStream, rate limiting, download tracking.


================================================================================
4. FRONTEND TRUKUMAI
================================================================================

4.1. Accessibility (WCAG 2.1 AA)                                [ISTAISYTA]
------------------------------------------------------
Visos problemos istaisytos:
- [x] aria-label ant icon-only mygtuku — jau buvo (18/18)
- [x] Lightbox rodykliu klavisai — jau buvo (useLightbox hook)
- [x] Color contrast — text-white/40 -> /50, text-white/30 -> /40
- [x] Skip to main content — MainLayout + MobileLayout
- [x] div onClick be role="button" — nerasta (visi naudoja <button>)
- [x] aria-invalid + aria-describedby — LoginPage, RegisterPage,
      ForgotPasswordPage, ResetPasswordPage
- [x] Accordion aria-controls/aria-labelledby — pataisyta su useId()
- [x] UserDetailModal Escape key — pridetas
- [ ] Dropdown rodykliu klavisai — low priority, click/tab veikia

4.2. Testu padengimas — apie 40%                                [LIKO]
------------------------------------------------------
- Tik 6 unit testai primityvams/kontekstams
- Nera integration testu
- E2E testai sukonfiguruoti (Playwright), bet mazai scenarijumi
- Tikslas turetu buti 70%+ padengimas

4.3. Auth loading busena                                         [ISTAISYTA]
------------------------------------------------------
SPRENDIMAS: Pakeistas `if (loading) return null` i branded spinner
su PixelForge logotipu ir animacija App.jsx.

4.4. Dead code                                                   [ISTAISYTA]
------------------------------------------------------
SPRENDIMAS: lightroomScript.js istrintas.

4.5. Vite konfiguracija                                          [LIKO]
------------------------------------------------------
- Dev proxy cookie tvarkymas naudoja fragile regex (vite.config.js)
- Nera production source maps (build.sourcemap)
- Nera rollup chunk splitting optimizacijos
- Nera code-splitting konfiguraciju
Zemesnis prioritetas — veikia teisingai dabartiniame deploymente.

4.6. Error tracking                                              [LIKO]
------------------------------------------------------
- Nera production error monitoring serviso (Sentry, LogRocket ar pan.)
- ErrorBoundary sugauna React klaidas, bet tik logina i konsole

4.7. Routing problemos                                           [ISTAISYTA]
------------------------------------------------------
- [x] 404 catch-all route — pridetas
- Logout navigate('/') ir query param isaugojimas — minor, veikia


================================================================================
5. BACKEND TRUKUMAI
================================================================================

5.1. Nera API dokumentacijos                                     [LIKO]
------------------------------------------------------
Nera OpenAPI/Swagger specifikacijos.
Naujam develperiui sudetinga suprasti visus endpoints.

5.2. Nera API versioning                                         [PRIIMTINA]
------------------------------------------------------
Visi routes be /v1/ prefikso.
Dabartiniame etape nereikalinga — vienas klientas, vienas serveris.

5.3. Nenaudojama composer dependency                             [LIKO]
------------------------------------------------------
nelmio/cors-bundle itrauktas i composer.json,
bet CORS tvarkomas rankiniu cors.php failu.
Galima pasalinti — minor cleanup.

5.4. Nera backend testu                                          [LIKO]
------------------------------------------------------
0% backend testu padengimas.
Nera PHPUnit ar kitu testavimo irankiu.

5.5. Nera cron job                                               [LIKO]
------------------------------------------------------
Nera automatizuotu uzduociu:
- Kolekciju galiojimo tikrinimas (dabar tikrinama runtime)
- Pasibaigsiu sesiju valymas
- Senu failu isvalymas (ARCHIVED kolekcijos)

5.6. Kolekciju slaptazodzio nustatymas                           [PASALINTA]
------------------------------------------------------
Pasalinta is plano — passwordless by design.

5.7. Promotional nuotrauku pertvarkymo trukumas                  [ISTAISYTA]
------------------------------------------------------
SPRENDIMAS: PATCH endpoint pridetas promotional.php.


================================================================================
6. DUOMENU BAZES PROBLEMOS
================================================================================

6.1. Schema nesinchronizuotas                                    [ISTAISYTA]
------------------------------------------------------
Visi 3 stulpeliai prideti i database_schema.sql.
Pasenusios migracijos komentarai issvalyti.

6.2. Kolekcijos statuso validation mismatch                      [DOKUMENTUOTA]
------------------------------------------------------
DOWNLOADED statusas intencionaliai isjungtas PATCH endpointe.
Nustatomas tik automatiskai per download handlers.
Pridetas komentaras collections/id.php.

6.3. PromotionalPhoto.photoId nera foreign key                   [DOKUMENTUOTA]
------------------------------------------------------
FK intencionaliai pasalintas — edited photos gali buti perkeltos/pakeistos.
Validacija atliekama PHP lygmenyje.
Pridetas komentaras database_schema.sql.

6.4. Pasenusios migracijos komentaruose                          [ISTAISYTA]
------------------------------------------------------
~150 eiluciu uzkomentaruotu ALTER TABLE komandu issvalyta.


================================================================================
7. KAS GERAI PADARYTA
================================================================================

Sritis                          | Ivertinimas | Pastabos
--------------------------------|-------------|----------------------------------
SQL injection apsauga           | 10/10       | 100% prepared statements, EMULATE_PREPARES=false
Failu upload saugumas           | 10/10       | MIME, dydis, path traversal, execution prevention
CSRF apsauga                    | 9/10        | timing-safe hash_equals(), tinkamos exemptions
i18n sinchronizacija            | 10/10       | LT/EN/RU pilnai sinchronizuoti (22 namespaces)
Responsive dizainas             | 9/10        | Desktop + mobile layouts, safe-area support
Error handling (frontend)       | 9/10        | Centralizuotas API klientas, toast pranesimai
Loading/empty states            | 9/10        | Skeleton loaders, empty states visur
Session saugumas                | 9/10        | Secure, HttpOnly, SameSite, User-Agent binding
Kodo organizacija               | 9/10        | Aiski struktura, nuoseklus patternai
Autentifikacija                 | 9/10        | bcrypt, rate limiting, session regeneration
Failu struktura                 | 9/10        | 14 pages, 25 components, 6 custom hooks
CORS konfiguracija              | 9/10        | Whitelist-based, no wildcard origins
Security headers                | 8/10        | Viskas yra isskyrus CSP
Password reset flow             | 9/10        | 1h token, one-time use, SHA256 hash
Google OAuth                    | 9/10        | JWT verification, auto email verify
Accessibility                   | 9/10        | WCAG AA contrast, aria attrs, skip-nav, keyboard nav
Delivery security               | 9/10        | Rate limiting, expiration checks, download tracking


================================================================================
8. LIKUSIOS UZDUOTYS (prioriteto tvarka)
================================================================================

 1. Prideti Content-Security-Policy header i .htaccess
 2. Prideti frontend testus (vitest) — tikslas 70%+
 3. Prideti backend testus (PHPUnit)
 4. Prideti error tracking (Sentry)
 5. Sukurti API dokumentacija (OpenAPI/Swagger)
 6. Prideti cron job kolekciju isvalymui
 7. Bulk operacijos (multi-delete, multi-status)
 8. Vite code-splitting / chunk optimizacija
 9. Pasalinti nelmio/cors-bundle is composer.json
10. Dropdown arrow key navigation (language switchers)


================================================================================
9. FAILU STRUKTURA (nuoroda)
================================================================================

photo-hub/
  frontend/
    src/
      pages/           — 14 puslapiu (pridetas NotFoundPage)
      components/      — 25 komponentai
      contexts/        — AuthContext.jsx
      hooks/           — 6 custom hooks
      utils/           — copyScript, download, api
      locales/         — en.json, lt.json, ru.json
      layouts/         — MainLayout, MobileLayout, ResponsiveLayout
    tailwind.config.js
    vite.config.js
    package.json
  backend/
    index.php          — Pagrindinis router
    db.php             — PDO connection factory
    config.php         — DB + SMTP + OAuth kredencialai
    cors.php           — CORS headers
    utils.php          — Failu upload + thumbnail handling
    auth/              — 6 auth handler failai
    collections/       — 9 kolekciju handler failai
    admin/             — 6 admin endpoint failai (pridetas download-stats)
    profile/           — me.php
    helpers/           — 7 utility failai (pridetas download-tracker)
    uploads/           — Ikeltos nuotraukos (apsaugota .htaccess)
    migrations/        — SQL migracijos
    composer.json
    .htaccess
  database_schema.sql  — MySQL schema (SINCHRONIZUOTAS)
  CLAUDE.md            — Projekto instrukcijos


================================================================================
           Ataskaita sugeneruota: 2026-02-26
           Paskutinis atnaujinimas: 2026-02-26
           Analizuota: ~110+ failu, ~20,000+ LOC
           Istaisyta: 22/32 rastų problemų
================================================================================
